---
title: "JPA Entity Serialize Exception with Redis Session"
search: false
category:
  - kotlin
  - spring-boot
  - jpa
last_modified_at: 2023-08-13T23:55:00
---

<br/>

#### RECOMMEND POSTS BEFORE THIS

* [Spring Session with Redis][spring-session-with-redis-link]
* [TestContainer for Database][test-container-for-database-link]

## 1. Problem Context

레디스(redis)를 위한 스프링 세션(spring session)을 사용하는 중 아래 로그처럼 엔티티(entity)를 직렬화(serialize)할 수 없다는 에러를 만났습니다. 

```
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96) ~[spring-data-redis-3.0.6.jar!/:3.0.6]
	at org.springframework.data.redis.core.AbstractOperations.rawHashValue(AbstractOperations.java:186) ~[spring-data-redis-3.0.6.jar!/:3.0.6]
	at org.springframework.data.redis.core.DefaultHashOperations.putAll(DefaultHashOperations.java:161) ~[spring-data-redis-3.0.6.jar!/:3.0.6]
	at org.springframework.session.data.redis.RedisSessionRepository$RedisSession.saveDelta(RedisSessionRepository.java:298) ~[spring-session-data-redis-3.0.1.jar!/:3.0.1]
	at org.springframework.session.data.redis.RedisSessionRepository$RedisSession.save(RedisSessionRepository.java:276) ~[spring-session-data-redis-3.0.1.jar!/:3.0.1]
  ...
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64) ~[spring-core-6.0.9.jar!/:6.0.9]
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33) ~[spring-core-6.0.9.jar!/:6.0.9]
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:94) ~[spring-data-redis-3.0.6.jar!/:3.0.6]
	... 37 common frames omitted
Caused by: java.io.NotSerializableException: action.in.blog.entity.UserEntity
	at java.base/java.io.ObjectOutputStream.writeObject0(Unknown Source) ~[na:na]
	at java.base/java.io.ObjectOutputStream.writeObject(Unknown Source) ~[na:na]
	at java.base/java.util.ArrayList.writeObject(Unknown Source) ~[na:na]
  ...
```

위 예외가 왜 발생했는지 알아보고 이를 해결한 방법에 대해 정리해보았습니다. 
프로젝트 개발 환경은 다음과 같습니다. 

* 코틀린(kotlin)
* JDK17
* 스프링 부트 3.0.7 버전
* 문제가 발생한 의존성
    * spring-boot-starter-data-jpa
    * spring-boot-starter-data-redis

문제가 발생한 상황은 다음과 같습니다. 

1. 사용자 정보를 데이터베이스에서 조회한다.
1. 사용자 정보 엔티티를 POJO 객체로 변환한 후 세션에 저장한다.
1. 요청에 대한 응답을 커밋하는 시점에 세션에 데이터를 저장하게 되는데 객체를 직렬화하는 과정에서 예외가 발생한다.

<p align="center">
    <img src="/images/jpa-entity-serialize-exception-with-redis-session-1.JPG" width="100%" class="image__border">
</p>

### 1.1. 


## CLOSING

#### TEST CODE REPOSITORY

#### RECOMMEND NEXT POSTS

#### REFERENCE

* <https://www.baeldung.com/spring-boot-redis-testcontainers>

[spring-session-with-redis-link]: https://junhyunny.github.io/information/spring-boot/redis/spring-session-with-redis/
[test-container-for-database-link]: https://junhyunny.github.io/post-format/test-container-for-database/