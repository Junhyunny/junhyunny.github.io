---
title: "Cursor in MySQL Procedure"
search: false
category:
  - database
  - mysql
last_modified_at: 2023-09-21T23:55:00
---

<br/>

#### RECOMMEND POSTS BEFORE THIS

## 1. Problem Context

테이블 스키마 모습이 적절하지 않아 변경 작업이 필요했습니다. 

* 비정형 문자열을 저장하는 두 개의 컬럼을 기본 키(PK, Primary Key)로 설정하고 있었습니다. 

```
mysql> describe JOURNAL_PUBLISHER_MAPPING;
+----------------+--------------+------+-----+---------+-------+
| Field          | Type         | Null | Key | Default | Extra |
+----------------+--------------+------+-----+---------+-------+
| JOURNAL_NAME   | varchar(100) | NO   | PRI | NULL    |       |
| PUBLISHER_NAME | varchar(100) | NO   | PRI | NULL    |       |
| JOURNAL_ID     | bigint       | YES  |     | NULL    |       |
| PUBLISHER_ID   | bigint       | YES  |     | NULL    |       |
+----------------+--------------+------+-----+---------+-------+
4 rows in set (0.00 sec)
```

저널, 출판사 이름을 기본 키로 설정하는 경우 이름이 같은 경우가 발생한다면 문제가 발생할 수 있습니다. 
전 세계 저널과 출판사를 대상으로 하기 때문에 가능성이 없는 것은 아니었습니다. 
위 테이블을 다음과 같이 변경하고자 했습니다. 

* 새로운 시퀀스(sequence) 기본 키 추가
* 유니크 키(unique key)로 JOURNAL_ID, PUBLISHER_ID 조합을 사용

```

```

## 2. Solve the problem



데이터는 약 40000건 이상 있었고, 어플리케이션을 만들어 처리하는 것보다 프로시저 


## CLOSING

#### TEST CODE REPOSITORY

#### RECOMMEND NEXT POSTS

#### REFERENCE

* 