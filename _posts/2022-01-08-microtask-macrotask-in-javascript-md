---
title: "Microtask & Macrotask in Javascript"
search: false
category:
  - information
  - javascript
last_modified_at: 2022-01-08T23:55:00
---

<br>

ğŸ‘‰ í•´ë‹¹ í¬ìŠ¤íŠ¸ë¥¼ ì½ëŠ”ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.
- [Asynchronous Task In JavaScript][how-to-work-javascript-async-link]

ğŸ‘‰ ì´ì–´ì„œ ì½ê¸°ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.
- [Recursive setTimeout test with Jest (feat. advanceTimersByTime ì—´ì–´ë³´ê¸°)][recursive-set-timeout-test-link]

## 0. ë“¤ì–´ê°€ë©´ì„œ

ìµœê·¼ `setTimeout(callback, timeout)` í•¨ìˆ˜ì˜ ì¬ê·€ì  í˜¸ì¶œì„ `Jest`ì˜ `advanceTimersByTime` í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì‹œ ë°œìƒí•œ ë¬¸ì œ ìƒí™©ì— ëŒ€í•œ ê¸€ì„ ì¼ìŠµë‹ˆë‹¤. 
ê¸€ì„ ì²˜ìŒ ì‘ì„±í–ˆì„ ë•ŒëŠ” ì„¤ëª…ì„ ì •ë§ ì˜ ì¨ë†¨ë‹¤ëŠ” ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤. 
í•˜ì§€ë§Œ, ë‹¤ìŒë‚  íŒ€ì›ë“¤ì—ê²Œ ì‘ì„±í•œ ê¸€ì„ ë³´ì—¬ì£¼ë©´ì„œ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆŒë• ëŠë‚Œì´ ì´ìƒí–ˆìŠµë‹ˆë‹¤. 

> 'ì§€ê¸ˆ ë‚´ê°€ ë­˜ ì„¤ëª…í•˜ê³  ìˆëŠ”ê±°ì§€?'<br>
> 'ë‚˜ë„ ì§€ê¸ˆ ë‚´ê°€ ì´ì•¼ê¸°í•˜ê³ ì í•˜ëŠ”ê²Œ ì •ë¦¬ê°€ ì•ˆëœë‹¤!'

ì˜ë…¼ì´ ì˜ ë˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ì €í•œí…Œ ìˆì—ˆëŠ”ë°, ì´ì•¼ê¸°ë¥¼ í•˜ë©´ì„œë„ ìŠ¤ìŠ¤ë¡œ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬(microtask)ì™€ ë§¤í¬ë¡œíƒœìŠ¤í¬(macrotask)ì— ëŒ€í•œ ì´í•´ë„ê°€ ì—„ì²­ ë‚®ë‹¤ë¼ëŠ” ê±¸ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤. 
ì˜¤ëŠ˜ì€ ì•Œê³  ìˆì—ˆë‹¤ê³  ìƒê°í–ˆì§€ë§Œ, ì˜ ëª°ëë˜ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬(microtask)ì™€ ë§¤í¬ë¡œíƒœìŠ¤í¬(macrotask)ì— ëŒ€í•œ ì •ë¦¬ë¥¼ í•´ë³´ë ¤í•©ë‹ˆë‹¤. 

## 1. ë§¤í¬ë¡œíƒœìŠ¤í¬(Macrotask)ì™€ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬(Microtask)

[Asynchronous Task In JavaScript][how-to-work-javascript-async-link] í¬ìŠ¤íŠ¸ì—ì„œ ì„¤ëª…í–ˆë“¯ì´ `Web API` ê¸°ëŠ¥ì´ ì¢…ë£Œë˜ë©´ ì½œë°±(callback) í•¨ìˆ˜ê°€ ì½œë°± í(callback queue)ì— ìˆœì„œëŒ€ë¡œ ë‹´ê¹ë‹ˆë‹¤. 
ì´ ë•Œ ì½œë°± í•¨ìˆ˜ê°€ ë‹´ê¸°ëŠ” íëŠ” ë‘ ê°€ì§€ ì¢…ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤. 
- ë§¤í¬ë¡œíƒœìŠ¤í¬ í (macrotask queue) - ìš°ì„ ìˆœìœ„ê°€ ë†’ìŠµë‹ˆë‹¤.
- ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ í (microtask queue) - ìš°ì„ ìˆœìœ„ê°€ ë‚®ìŠµë‹ˆë‹¤.

ë§¤í¬ë¡œíƒœìŠ¤í¬ì™€ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ëŠ” ìš°ì„ ìˆœìœ„ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ì‹¤í–‰ë˜ëŠ” ìˆœì„œë„ ë‹¤ë¦…ë‹ˆë‹¤. 
ë‹¹ì—°íˆ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ê°€ ë¨¼ì € ìˆ˜í–‰ë˜ê³ , ë‹¤ìŒìœ¼ë¡œ ë§¤í¬ë¡œíƒœìŠ¤í¬ê°€ ìˆ˜í–‰ë©ë‹ˆë‹¤. 
ì´ë²¤íŠ¸ ë£¨í”„(event loop)ëŠ” ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì— ë‹´ê¸´ ëª¨ë“  ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ë¥¼ ì²˜ë¦¬í•œ í›„ì— ë§¤í¬ë¡œíƒœìŠ¤í¬ë¥¼ ì†Œë¹„í•©ë‹ˆë‹¤.

##### ë§¤í¬ë¡œíƒœìŠ¤í¬ì™€ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ ì‹¤í–‰ ìˆœì„œ

<p align="center"><img src="/images/microtask-macrotask-in-javascript-1.gif" width="75%"></p>
<center>ì´ë¯¸ì§€ ì¶œì²˜, https://dev.to/lydiahallie/javascript-visualized-promises-async-await-5gke</center><br>

##### ìš©ì–´ ì •ë¦¬
`ECMAScript` ì§„ì˜ì€ ë‹¤ë¥¸ ìš©ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ê°„ëµí•œ í‘œë¡œ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.

| ECAM | V8 ì—”ì§„ | 
|:---:|:---:|:---|
| Message Queue | Macrotask Queue (í˜¹ì€ Task Queue) |
| PromiseJobs | Microtask Queue |

## 2. ë§¤í¬ë¡œíƒœìŠ¤í¬ì™€ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ ìƒì„±

ë§¤í¬ë¡œíƒœìŠ¤í¬ì™€ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ ëŒ€ìƒì€ ì–´ëŠ ì˜ì—­ì¸ì§€, ì–¸ì œ ë§¤í¬ë¡œíƒœìŠ¤í¬ì™€ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ê°€ ìƒì„±ë˜ëŠ”ì§€ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. 

### 2.1. ë§¤í¬ë¡œíƒœìŠ¤í¬ ìƒì„±

ë§¤í¬ë¡œíƒœìŠ¤í¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ ìƒì„±ë©ë‹ˆë‹¤. 
- setTimeout(callback, timeout) 
    - ë§¤í¬ë¡œíƒœìŠ¤í¬ ëŒ€ìƒì€ callback í•¨ìˆ˜ì…ë‹ˆë‹¤.
    - `timeout` ì‹œê°„ì´ ì§€ë‚œ í›„ callback í•¨ìˆ˜ê°€ íë¡œ ì´ë™í•©ë‹ˆë‹¤. 
    - í•œë²ˆë§Œ ì‹¤í–‰í•©ë‹ˆë‹¤.
- setInterval(callback, timeout)
    - ë§¤í¬ë¡œíƒœìŠ¤í¬ ëŒ€ìƒì€ callback í•¨ìˆ˜ì…ë‹ˆë‹¤.
    - `timeout` ì‹œê°„ì´ ì§€ë‚œ í›„ callback í•¨ìˆ˜ê°€ íë¡œ ì´ë™í•©ë‹ˆë‹¤. 
    - ì§€ì†ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.
- setImmediate(callback)
    - ë§¤í¬ë¡œíƒœìŠ¤í¬ ëŒ€ìƒì€ callback í•¨ìˆ˜ì…ë‹ˆë‹¤.
    - Internet Explorer 10 ë²„ì „ì—ì„œë§Œ ì§€ì› ([Window.setImmediate()][immediate-link])
- requestAnimationFrame(callback)
    - ë§¤í¬ë¡œíƒœìŠ¤í¬ ëŒ€ìƒì€ callback í•¨ìˆ˜ì…ë‹ˆë‹¤.

##### ì˜ˆì‹œ ì½”ë“œ - setTimeout(callback, timeout)

```javascript
const foo = () => console.log("First");
const bar = () => setTimeout(() => console.log("Second"), 500);
const baz = () => console.log("Third");

bar();
foo();
baz();
```

##### ì½”ë“œ ë™ì‘ ê³¼ì •

<p align="center"><img src="/images/microtask-macrotask-in-javascript-2.gif" width="75%"></p>
<center>ì´ë¯¸ì§€ ì¶œì²˜, https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif</center><br>

### 1.2. ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ ìƒì„±



### 1.2.1. Promise

### 1.2.2. async / await

## 2. íƒœìŠ¤í¬ ì‹¤í–‰ ìˆœì„œ ë§ì¶”ê¸°



## CLOSING

#### TEST CODE REPOSITORY
- <>

#### REFERENCE
- <https://dev.to/lydiahallie/javascript-visualized-promises-async-await-5gke>
- <https://javascript.info/event-loop#macrotasks-and-microtasks>
- <https://meetup.toast.com/posts/89>
- <https://codingsalon.tistory.com/59>


- <https://baeharam.netlify.app/posts/javascript/JS-Task%EC%99%80-Microtask%EC%9D%98-%EB%8F%99%EC%9E%91%EB%B0%A9%EC%8B%9D>
- <https://haesoo9410.tistory.com/322>

[immediate-link]: https://developer.mozilla.org/en-US/docs/Web/API/Window/setImmediate

[how-to-work-javascript-async-link]: https://junhyunny.github.io/information/javascript/how-to-work-javascript-async/

[recursive-set-timeout-test-link]: https://junhyunny.github.io/react/jest/exception/recursive-set-timeout-test/