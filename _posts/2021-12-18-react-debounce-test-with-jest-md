---
title: "React debounce test with Jest"
search: false
category:
  - information
  - react
  - jest
last_modified_at: 2021-12-18T23:55:00
---

<br>

## 1. 디바운스, Debounce

이벤트를 그룹화하여 특정시간이 지난 후 하나의 이벤트만 발생하도록 하는 기술입니다. 
순차적 호출을 하나의 그룹으로 만들고, 맨 마지막 함수(혹은 맨 처음)만 호출합니다. 
잦은 이벤트로 인한 부하로 성능 문제를 일으킬 수 있는 경우 사용합니다. 

예를 들어, 사용자가 검색창에 키워드를 입력할 때 변경 내용마다 서버로 API 요청을 하는 것은 서버와 브라우저 모두에게 부하를 일으킵니다. 
이런 경우에 디바운스를 이용합니다. 
사용자 입력이 멈춘 후 일정 시간이 지나면 사용자 입력을 모아 한번만 요청합니다. 

##### 디바운스 처리 방법

<p align="center"><img src="/images/2021-12-18-react-debounce-test-with-jest-1.JPG" width="75%"></p>
<center>이미지 출처, https://codepen.io/jaehee/pen/XoKeRW</center>

## 2. Jest 테스트

### 2.1. 테스트 코드

#### 2.1.1. element rendering 테스트
- 컴포넌트 렌더링 후 화면에 element들이 존재하는지 확인합니다.

```javascript
    describe('test rendering elements', () => {

        it('exists input box for search and message when rendered', () => {

            // setup, act
            render(<App/>);

            // assert
            expect(screen.getByPlaceholderText('검색어')).toBeInTheDocument()
            expect(screen.getByText('현재 API 호출 횟수 = 0')).toBeInTheDocument();
        });
    });
```

#### 2.1.2. 사용자 조작 테스트
- 입력창에 검색 키워드 입력 후 적절한 파라미터와 함께 `axios` 호출이 1회 있었는지 확인합니다.
- 화면에 보이는 문구가 변경되

```javascript
    describe('test user interaction', () => {

        it('call axios get method one time when typed some keyword', () => {

            // setup
            jest.useFakeTimers();
            const spyAxios = jest.spyOn(axios, 'get').mockResolvedValue({data: {}});

            // act
            render(<App/>);
            userEvent.type(screen.getByPlaceholderText('검색어'), 'Junhyunny');
            act(() => {
                jest.advanceTimersByTime(500);
            });

            // assert
            expect(spyAxios).toHaveBeenNthCalledWith(1, 'http://localhost:8080/search', {
                params: {
                    keyword: 'Junhyunny'
                }
            });
            expect(screen.getByText('현재 API 호출 횟수 = 1')).toBeInTheDocument();
        });
    });
```

### 2.2. 디바운싱 코드

### 2.3. useCallback Hook

### 2.4. onChange Event

## 3. 테스트 결과

#### TEST CODE REPOSITORY
- <https://github.com/Junhyunny/blog-in-action/tree/master/2021-11-26-test-double>

#### REFERENCE
- <https://webclub.tistory.com/607>
- <https://codepen.io/jaehee/pen/XoKeRW>